{"version":3,"file":"lit-selector.js","sourceRoot":"","sources":["lit-selector.ts"],"names":[],"mappings":";;;;;;AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,KAAK,CAAC;AACjC,OAAO,EAAE,aAAa,EAAE,QAAQ,EAAE,MAAM,gBAAgB,CAAC;AACzD,OAAO,EAAC,UAAU,EAAC,MAAM,aAAa,CAAC;AAGvC,IAAa,WAAW,GAAxB,MAAa,WAAY,SAAQ,UAAU;IAA3C;;QAEI,kBAAa,GAAY,KAAK,CAAC;QAG/B,sBAAiB,GAAmB,IAAI,CAAC;QAGzC,aAAQ,GAA6B,IAAI,CAAC;QAE1C,eAAU,GAAqB,IAAI,UAAU,CAAC,CAAC,IAAI,EAAE,UAAU,EAAE,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,UAAU,CAAC,CAAC,CAAC;QAE3G,WAAM,GAAgB,EAAE,CAAC;IA4G7B,CAAC;IA1GG,IAAI,KAAK;QACL,OAAO,IAAI,CAAC,MAAM,CAAC;IACvB,CAAC;IAED,iBAAiB;QACb,KAAK,CAAC,iBAAiB,EAAE,CAAC;QAE1B,IAAI,CAAC,gBAAgB,CAAC,YAAY,EAAE,KAAK,CAAC,EAAE;YACxC,KAAK,CAAC,eAAe,EAAE,CAAC;YACxB,IAAI,CAAC,WAAW,EAAE,CAAC;YACnB,IAAI,CAAC,aAAa,CAAC,IAAI,WAAW,CAAC,wBAAwB,EAAE,EAAE,MAAM,EAAE,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAC,CAAC,CAAC,CAAC;QAC/F,CAAC,CAAC,CAAC;QAEL,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IACzC,CAAC;IAED,oBAAoB;QAChB,KAAK,CAAC,oBAAoB,EAAE,CAAC;QAC7B,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IAC5C,CAAC;IAED,wBAAwB,CAAC,IAAa,EAAE,MAAY,EAAE,MAAY;QAC9D,KAAK,CAAC,wBAAwB,CAAC,IAAI,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC;QACrD,QAAQ,IAAI,EAAE;YACV,KAAK,UAAU,CAAC,CAAC;gBACb,IAAI,CAAC,cAAc,EAAE,CAAC;gBACtB,MAAM;aACT;SACJ;IACL,CAAC;IAED,cAAc,CAAC,IAAU,EAAE,UAAmB;QAC1C,IAAI,IAAI,CAAC,iBAAiB,IAAI,IAAI,YAAY,OAAO,EAAE;YACnD,IAAI,UAAU,IAAK,IAAgB,CAAC,YAAY,CAAC,IAAI,CAAC,iBAAiB,CAAC;gBACnE,IAAgB,CAAC,eAAe,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;SACjE;IACL,CAAC;IAED,WAAW;;QACP,IAAI,WAAW,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QAC7C,IAAI,CAAC,MAAM,GAAG,MAAA,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,aAAa,EAAE,mCAAI,EAAE,CAAC;IACrD,CAAC;IAED,WAAW,CAAC,SAAkB;QAC1B,IAAI,CAAC,gBAAgB,CAAC,SAAS,EAAE,CAAC,KAAK,EAAE,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC,CAAC;IAC7E,CAAC;IAED,cAAc,CAAC,SAAkB;QAC7B,IAAI,CAAC,mBAAmB,CAAC,SAAS,EAAE,CAAC,KAAK,EAAE,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC,CAAC;IAChF,CAAC;IAED,eAAe,CAAC,KAAa;QACzB,IAAI,CAAC,GAAG,KAAK,CAAC,MAAc,CAAC;QAC7B,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;QACvB,OAAO,CAAC,IAAI,CAAC,IAAI,IAAI,EAAE;YACnB,IAAI,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YACzB,IAAI,CAAC,IAAI,CAAC,EAAE;gBACR,IAAI,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;gBACjC,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;gBAC5B,OAAO;aACV;YACD,aAAa;YACb,CAAC,GAAG,CAAC,CAAC,UAAU,CAAC;SACpB;IACL,CAAC;IAED,YAAY,CAAC,KAAU,EAAE,IAAS;QAC9B,IAAI,IAAI,CAAC,aAAa,CAAC,IAAI,WAAW,CAAC,wBAAwB,EAAE,EAAE,MAAM,EAAE,EAAC,QAAQ,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,EAAC,EAAE,QAAQ,EAAE,IAAI,EAAE,UAAU,EAAE,IAAI,EAAC,CAAC,CAAC;YACzI,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IAC3B,CAAC;IAED,MAAM,CAAC,KAAU;QACb,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;IAC1B,CAAC;IAED,cAAc;QACV,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACvC,CAAC;IAED,cAAc,CAAC,QAAgC;QAC3C,IAAI,CAAC,IAAI,CAAC,MAAM;YACZ,OAAO;QAEX,IAAI,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC3C,IAAI,IAAI,EAAE;YACN,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;SAChC;aAAM;YACH,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,CAAC;SAC3B;IACL,CAAC;IAED,WAAW,CAAC,KAA6B;QACrC,OAAO,CAAC,KAAK,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC;IAC1E,CAAC;IAED,YAAY,CAAC,KAAsB;QAC/B,OAAO,MAAM,CAAC,KAAK,CAAC,CAAC;IACzB,CAAC;IAED,YAAY,CAAC,KAAc;QACvB,OAAO,KAAK,CAAC;IACjB,CAAC;IAED,OAAO,CAAC,IAAU;QACd,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACxD,CAAC;CACJ,CAAA;AAtHG;IADC,QAAQ,CAAC,EAAC,IAAI,EAAE,MAAM,EAAE,SAAS,EAAE,gBAAgB,EAAC,CAAC;kDACvB;AAG/B;IADC,QAAQ,CAAC,EAAC,IAAI,EAAE,MAAM,EAAE,SAAS,EAAE,oBAAoB,EAAC,CAAC;sDACjB;AAGzC;IADC,QAAQ,CAAC,EAAC,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAC,CAAC;6CACE;AARjC,WAAW;IADvB,aAAa,CAAC,cAAc,CAAC;GACjB,WAAW,CAwHvB;SAxHY,WAAW","sourcesContent":["import { LitElement } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport {XSelection} from './selection';\n\n@customElement('lit-selector')\nexport class LitSelector extends LitElement {\n    @property({type: String, attribute: 'activate-event'})\n    activateEvent : string = 'tap';\n\n    @property({type: String, attribute: 'selected-attribute'})\n    selectedAttribute : string | null = null;\n\n    @property({type: Number, reflect: true})\n    selected :  number | string | null = null;\n\n    _selection: XSelection<Node> = new XSelection((item, isSelected) => this.applySelection(item, isSelected));\n\n    _items: Array<Node> = [];\n\n    get items(): Array<Node> {\n        return this._items;\n    }\n\n    connectedCallback() {\n        super.connectedCallback();\n\n        this.addEventListener('slotchange', event => {\n            event.stopPropagation();\n            this.updateItems();\n            this.dispatchEvent(new CustomEvent(\"selector-items-changed\", { detail: {}, composed: true}));\n          });\n\n        this.addListener(this.activateEvent);\n    }\n\n    disconnectedCallback() {\n        super.disconnectedCallback();\n        this.removeListener(this.activateEvent);\n    }\n\n    attributeChangedCallback(name : string, oldval : any, newval : any) {\n        super.attributeChangedCallback(name, oldval, newval);\n        switch (name) {\n            case 'selected': {\n                this.updateSelected();\n                break;\n            }\n        }\n    }\n\n    applySelection(item: Node, isSelected: boolean) {\n        if (this.selectedAttribute && item instanceof Element) {\n            if (isSelected != (item as Element).hasAttribute(this.selectedAttribute))\n                (item as Element).toggleAttribute(this.selectedAttribute);\n        }\n    }\n\n    updateItems() {\n        var slotElement = this.querySelector(\"slot\");\n        this._items = slotElement?.assignedNodes() ?? [];\n    }\n\n    addListener(eventName : string) {\n        this.addEventListener(eventName, (event) => this.activateHandler(event));\n    }\n\n    removeListener(eventName : string) {\n        this.removeEventListener(eventName, (event) => this.activateHandler(event));\n    }\n\n    activateHandler(event : Event) {\n        var t = event.target as Node;\n        var items = this.items;\n        while (t && t != this) {\n            var i = items.indexOf(t);\n            if (i >= 0) {\n                var value = this.indexToValue(i);\n                this.itemActivate(value, t);\n                return;\n            }\n            // @ts-ignore\n            t = t.parentNode;\n        }\n    }\n\n    itemActivate(value: any, item: any) {\n        if (this.dispatchEvent(new CustomEvent('selector-item-activate', { detail: {selected: value, item: item}, composed: true, cancelable: true})))\n            this.select(value);\n    }\n\n    select(value: any) {\n        this.selected = value;\n    }\n\n    updateSelected() {\n        this.selectSelected(this.selected);\n    }\n\n    selectSelected(selected: number | string | null) {\n        if (!this._items)\n            return;\n\n        var item = this.valueToItem(this.selected);\n        if (item) {\n            this._selection.select(item);\n        } else {\n            this._selection.clear();\n        }\n    }\n\n    valueToItem(value: number | string | null): Node {\n        return (value == null) ? null : this._items[this.valueToIndex(value)];\n    }\n\n    valueToIndex(value: number | string): number {\n        return Number(value);\n    }\n\n    indexToValue(index : number) : any {\n        return index;\n    }\n\n    indexOf(item: Node): number {\n        return this._items ? this._items.indexOf(item) : -1;\n    }\n}"]}